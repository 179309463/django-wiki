{% load i18n wiki_tags wiki_images_tags humanize thumbnail %}
{% load url from future %}

<h4>{% trans "Available images" %}</h4>

<p>{% trans "Click on an image below to insert in your text. The format of the code inserted is:" %}<br /><code>[image:id alignment caption text]</code></p>

<div style="max-height: 300px; overflow: auto;">
  <table class="table table-striped">
    {% for image in article|images_for_article %}
      {% thumbnail image.image "150x50" crop="center" as thumb %}
        <tr>
          <td>
          <div class="thumbnail">
            <img src="{{ thumb.url }}" alt="{{ image.get_filename }}" />
          </div>
          </td>
          <td>
            <span class="label">
              {% trans "uploaded" %} {{ image.created|naturaltime }}
            </span>
          </td>
        </tr>
      {% endthumbnail %}
    {% empty %}
    <tr>
      <td><em>{% trans "No images found for this article" %}</em></td>
    </tr>
    {% endfor %}
  </table>
</div>

<p>
  <a href="{% url 'wiki:images_index' path=urlpath.path article_id=article.id %}">
    {% trans "Manage images" %} &raquo;
  </a>
</p>

<hr />

<h4>{% trans "Add new image" %}</h4>

{% if article|images_can_add:user %}
  {% if form.non_field_errors %}
    {% if form_error_title %}<h4 class="alert-heading">{{ form_error_title }}</h4>{% endif %}
    {% for error_message in form.non_field_errors %}
      <div class="alert alert-block alert-error">
        {{ error_message }}
      </div>    
    {% endfor %}
  {% endif %}

  {% for field in form %}
  <fieldset id="div_{{ field.auto_id }}" class="control-group fields {% if field.errors %} error{% endif %}">
    {% if field.label %}
      <!--<label for="{{ field.id_for_label }}" class="{% if field.field.required %}requiredField{% endif %}">
      {{ field.label|safe }}
      </label>-->
    {% endif %}
    {{ field }}
    {% if field.errors %}
    <div id="error_{{ forloop.counter }}_{{ field.auto_id }}" class="help-block">
      {% for error in field.errors %}
      <div>{{ error }}</div>
      {% endfor %}
    </div>
    {% endif %}
  </fieldset>
    {% if field.help_text %}
      <p id="hint_{{ field.auto_id }}" class="help-block">{{ field.help_text|safe }}</p>
    {% endif %}
  {% endfor %}

  <p>
    <button type="submit" name="{{ plugin.slug }}_save" value="1" class="btn btn-large">
      <span class="icon-upload"></span>
      {% trans "Add image" %}
    </button>
  </p>
{% else %}
  
  {% if user.is_anonymous %}
    {% include "wiki/includes/anonymous_blocked.html" %}
  {% else %}
    <p><em>{% trans "You do not have permissions to add images." %}</em></p>
  {% endif %}
{% endif %}
