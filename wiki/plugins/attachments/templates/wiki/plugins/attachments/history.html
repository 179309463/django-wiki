{% extends "wiki/base.html" %}
{% load wiki_tags i18n humanize %}
{% load url from future %}

{% block pagetitle %}{% trans "History of" %} "{{ attachment.current_revision.get_filename }}"{% endblock %}

{% block wiki_breadcrumbs %}
  {% include "wiki/includes/breadcrumbs.html" %}
{% endblock %}

{% block wiki_contents %}

  {% article_for_object urlpath as article %}

  {% if article %}
    <div class="tabbable tabs-top" style="margin-top: 40px;">
      <ul class="nav nav-tabs">
        {% with "attachments" as selected %}
          {% include "wiki/includes/article_menu.html" %}
        {% endwith %}
        <li>
          <h1 style="margin-top: -10px;">
            {{ article.current_revision.title }}
          </h1>
        </li>
      </ul>
      <div class="tab-content">
        <h2>{% trans "History of" %} "{{ attachment.current_revision.get_filename }}"</h2>
        <table class="table table-striped table-bordered">
          <tr>
            <th>{% trans "Date" %}</th>
            <th>{% trans "User" %}</th>
            <th>{% trans "Description" %}</th>
            <th>{% trans "File" %}</th>
            <th>{% trans "Size" %}</th>
            <th style="text-align: right">{% trans "Action" %}</th>
          </tr>
        {% for revision in revisions %}
          <tr>
            <td>
              {{ revision.created }}
              {% if revision.deleted %}<span class="badge badge-important">{% trans "deleted" %}</span>{% endif %}
            </td>
            <td>
              {% if revision.user %}{{ revision.user }}{% else %}{% if user|is_moderator %}{{ revision.ip_address|default:"anonymous (IP not logged)" }}{% else %}{% trans "anonymous (IP logged)" %}{% endif %}{% endif %}
            </td>
            <td>{{ revision.description|default:_("<em>No description</em>")|safe }}</td>
            <td>{{ revision.get_filename }}</td>
            <td>{{ revision.file.size|filesizeformat }}</td>
            <td style="text-align: right">
              <form method="POST" action="{% url 'wiki:attachments_revision_change' path=urlpath.path attachment_id=attachment.id revision_id=revision.id %}">
                {% csrf_token %}
                <a href="{% url 'wiki:attachments_download' path=urlpath.path attachment_id=attachment.id revision_id=revision.id %}" class="btn btn-primary">
                  <span class="icon-download"></span>
                  {% trans "Download" %}
                </a>
                {% if revision.attachment.article|can_write:user %}
                    <button{% if revision == attachment.current_revision %} disabled="disabled"{% endif %} class="btn">
                      <span class="icon-flag"></span>
                    {% trans "Use this!" %}
                    </button>
                {% endif %}
              </form>
            </td>
          </tr>
        {% endfor %}
        </table>
        <a href="{% url 'wiki:attachments_index' path=urlpath.path %}"><span class="icon-arrow-left"></span> {% trans "Go back" %}</a>
      </div>
    </div>

    <div class="tabbable tabs-below" style="margin-top: 20px;">
      <ul class="nav nav-tabs">
        <li style="margin-top: 10px;"><em>{% trans "Article last modified:" %} {{ article.current_revision.modified }}</em></li>
      </ul>
    </div>
    
  {% else %}
    {% trans "An article for this path does not exist." %}
  {% endif %}
  
{% endblock %}

